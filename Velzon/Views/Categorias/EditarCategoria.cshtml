@{
    ViewBag.Title = "Form layout";
    ViewBag.pTitle = "Form layout";
    ViewBag.pageTitle = "Forms";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model Velzon.Models.tb_categoria_produto

@{
    var mensagem = TempData["mensagem"] as string; // Armazena o valor de TempData em uma variável
}

@if (mensagem == "Operação realizada com sucesso!")
{
    <div class="alert alert-success" role="alert">
        @mensagem
    </div>
}
else if (mensagem == "Por favor, preencha todos os campos obrigatórios para continuar.")
{
    <div class="alert alert-danger" role="alert">
        @mensagem
    </div>
}


<div class="row">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header align-items-center d-flex">
                    <h4 class="card-title mb-0 flex-grow-1">Cadastrar Categoria</h4>
                    <div class="flex-shrink-0">
                    </div>
                </div><!-- end card header -->
                <div class="card-body">
                    <p class="text-muted">Aqui você pode realizar o cadastrarProduto da categoria</p>
                    <div class="live-preview">
                        <form asp-controller="Categorias" asp-action="EditarCategoria" method="post">
                            @* @Html.AntiForgeryToken() *@
                            <div class="row g-3">

                                <div class="col-lg-2">
                                    <div class="form-floating">
                                        <input asp-for="cp_desc" type="text" class="form-control"
                                            id="DescricaoCategoria" minlength="5" maxlength="200"
                                            placeholder="Descrição da categoria">
                                        <label for="pd_codRef">Descrição da categoria</label>
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <div class="form-floating">
                                        <select asp-for="fk_tb_secao_produto" class="form-select" id="Secao"
                                            aria-label="Floating label select example">
                                            <option selected>Selecione...</option>
                                        </select>
                                        <label for="Secao">Seção</label>
                                    </div>
                                </div>


                                @* pegando apenas o id da categoria *@
                                <div class="col-lg-2">
                                    <div class="form-floating">
                                        <input asp-for="id_categoria_produto" type="hidden" class="form-control"
                                            id="DescricaoCategoria" minlength="5" maxlength="200"
                                            placeholder="Descrição da categoria">
                                    </div>
                                </div>

                                <div class="col-lg-12">
                                    <div class="text-end">
                                        <button type="submit" class="btn btn-primary">Salvar</button>
                                    </div>
                                </div>
                            </div>

                        </form>
                    </div>
                    <div class="d-none code-view">
                        <pre class="language-markup" style="height: 275px">
<code>&lt;form action=&quot;#&quot;&gt;
    &lt;div class=&quot;row g-3&quot;&gt;
        &lt;div class=&quot;col-lg-6&quot;&gt;
            &lt;div class=&quot;form-floating&quot;&gt;
                &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;firstnamefloatingInput&quot; placeholder=&quot;Enter your firstname&quot;&gt;
                &lt;label for=&quot;firstnamefloatingInput&quot;&gt;First Name&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-lg-6&quot;&gt;
            &lt;div class=&quot;form-floating&quot;&gt;
                &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;lastnamefloatingInput&quot; placeholder=&quot;Enter your Lastname&quot;&gt;
                &lt;label for=&quot;lastnamefloatingInput&quot;&gt;Last Name&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-lg-4&quot;&gt;
            &lt;div class=&quot;form-floating&quot;&gt;
                &lt;input type=&quot;email&quot; class=&quot;form-control&quot; id=&quot;emailfloatingInput&quot; placeholder=&quot;Enter your email&quot;&gt;
                &lt;label for=&quot;emailfloatingInput&quot;&gt;Email Address&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-lg-4&quot;&gt;
            &lt;div class=&quot;form-floating&quot;&gt;
                &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;passwordfloatingInput&quot; placeholder=&quot;Enter your password&quot;&gt;
                &lt;label for=&quot;passwordfloatingInput&quot;&gt;Password&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-lg-4&quot;&gt;
            &lt;div class=&quot;form-floating&quot;&gt;
                &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;passwordfloatingInput1&quot; placeholder=&quot;Confirm password&quot;&gt;
                &lt;label for=&quot;passwordfloatingInput1&quot;&gt;Confirm Password&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-lg-4&quot;&gt;
            &lt;div class=&quot;form-floating&quot;&gt;
                &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;cityfloatingInput&quot; placeholder=&quot;Enter your city&quot;&gt;
                &lt;label for=&quot;cityfloatingInput&quot;&gt;City&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-lg-4&quot;&gt;
            &lt;div class=&quot;form-floating&quot;&gt;
                &lt;select class=&quot;form-select&quot; id=&quot;floatingSelect&quot; aria-label=&quot;Floating label select example&quot;&gt;
                  &lt;option selected&gt;USA&lt;/option&gt;
                  &lt;option value=&quot;1&quot;&gt;Brazil&lt;/option&gt;
                  &lt;option value=&quot;2&quot;&gt;France&lt;/option&gt;
                  &lt;option value=&quot;3&quot;&gt;Germany&lt;/option&gt;
                &lt;/select&gt;
                &lt;label for=&quot;floatingSelect&quot;&gt;Country&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-lg-4&quot;&gt;
            &lt;div class=&quot;form-floating&quot;&gt;
                &lt;input type=&quot;number&quot; class=&quot;form-control&quot; id=&quot;zipfloatingInput&quot; placeholder=&quot;Enter your zipcode&quot;&gt;
                &lt;label for=&quot;zipfloatingInput&quot;&gt;Zipcode&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col-lg-12&quot;&gt;
            &lt;div class=&quot;text-end&quot;&gt;
                &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Submit&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/form&gt;</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @section scripts {
        <!-- prismjs plugin -->
        <script src="~/assets/libs/prismjs/prism.js"></script>
        <script src="~/assets/js/app.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate-unobtrusive/3.2.13/jquery.validate.unobtrusive.min.js"></script>

        <script>
            const baseUrlSecao = window.location.origin;
            const apiUrlSecao = `${baseUrlSecao}/Secao/GetSecao`;
            const comboBoxSecao = document.getElementById("Secao");

            // Valor atual do campo (ID da seção) vindo do modelo via Razor
            const secaoSelecionada = @Html.Raw(Json.Serialize(Model.fk_tb_secao_produto ?? 0));

            async function carregarSecao() {
                try {
                    const response = await fetch(apiUrlSecao);

                    if (!response.ok) {
                        throw new Error("Erro ao buscar as seções cadastradas.");
                    }

                    const secoes = await response.json();
                    console.log(secoes);

                    // Limpa as opções anteriores
                    comboBoxSecao.innerHTML = '<option selected disabled>Selecione...</option>';

                    // Adiciona as opções dinamicamente
                    secoes.forEach(secao => {
                        const option = document.createElement("option");
                        option.value = secao.id_secao_produto; // Define o value como o ID da seção
                        option.textContent = secao.sp_desc; // Define o texto como o nome da seção

                        // Marca a opção como selecionada se o ID corresponder ao valor atual
                        if (secao.id_secao_produto === secaoSelecionada) {
                            option.selected = true;
                        }

                        comboBoxSecao.appendChild(option);
                    });
                } catch (error) {
                    console.error("Erro ao carregar as seções:", error);
                }
            }

            // Chama a função ao carregar a página
            document.addEventListener("DOMContentLoaded", carregarSecao);
        </script>



    }